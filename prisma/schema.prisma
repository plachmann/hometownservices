// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model ServiceCategory {
  id           String    @id @default(uuid())
  name         String    @db.VarChar(100)
  slug         String    @unique @db.VarChar(100)
  description  String?   @db.VarChar(500)
  displayOrder Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  services     Service[]

  @@map("service_categories")
}

model Service {
  id              String           @id @default(uuid())
  name            String           @db.VarChar(100)
  slug            String           @unique @db.VarChar(100)
  description     String           @db.Text
  imageUrl        String?          @db.VarChar(500)
  isSubcontracted Boolean          @default(false)
  categoryId      String
  category        ServiceCategory  @relation(fields: [categoryId], references: [id])
  displayOrder    Int              @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  inquiries       ContactInquiry[]

  @@index([categoryId])
  @@index([slug])
  @@map("services")
}

enum InquiryStatus {
  NEW
  READ
  RESPONDED
  ARCHIVED
}

model ContactInquiry {
  id        String        @id @default(uuid())
  name      String        @db.VarChar(100)
  email     String        @db.VarChar(255)
  phone     String?       @db.VarChar(20)
  serviceId String?
  service   Service?      @relation(fields: [serviceId], references: [id])
  message   String        @db.Text
  status    InquiryStatus @default(NEW)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([status])
  @@index([createdAt(sort: Desc)])
  @@map("contact_inquiries")
}

model AdminUser {
  id           String   @id @default(uuid())
  username     String   @unique @db.VarChar(50)
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("admin_users")
}

model SiteSettings {
  id               String   @id @default("singleton")
  serviceAreaLat   Decimal  @db.Decimal(10, 7)
  serviceAreaLng   Decimal  @db.Decimal(10, 7)
  serviceAreaMiles Int
  companyName      String   @db.VarChar(100)
  companyPhone     String   @db.VarChar(20)
  companyEmail     String   @db.VarChar(255)
  companyAddress   String?  @db.Text
  updatedAt        DateTime @updatedAt

  @@map("site_settings")
}
